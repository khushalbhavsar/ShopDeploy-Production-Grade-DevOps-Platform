#==============================================================================
# ShopDeploy Backend - Staging Values
# Override configuration for staging environment
#==============================================================================

global:
  environment: staging
  # namespace is set via --namespace flag in helm command

replicaCount: 2

image:
  pullPolicy: IfNotPresent

#------------------------------------------------------------------------------
# Resource Configuration (Staging - Medium resources)
#------------------------------------------------------------------------------
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 300m
    memory: 384Mi

#------------------------------------------------------------------------------
# Autoscaling Configuration
#------------------------------------------------------------------------------
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 75
  targetMemoryUtilizationPercentage: 80

#------------------------------------------------------------------------------
# Environment Variables
#------------------------------------------------------------------------------
env:
  NODE_ENV: "staging"
  LOG_LEVEL: "info"
  PORT: "5000"

#------------------------------------------------------------------------------
# Service Configuration
#------------------------------------------------------------------------------
service:
  type: ClusterIP
  port: 5000

#------------------------------------------------------------------------------
# Ingress Configuration
#------------------------------------------------------------------------------
ingress:
  enabled: true
  className: "alb"
  annotations:
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/healthcheck-path: /api/health/health
  hosts:
    - host: api-staging.shopdeploy.example.com
      paths:
        - path: /
          pathType: Prefix

#------------------------------------------------------------------------------
# Pod Disruption Budget
#------------------------------------------------------------------------------
podDisruptionBudget:
  enabled: true
  minAvailable: 1

#------------------------------------------------------------------------------
# Probes - Standard configuration
# Health endpoints: /api/health/health (liveness), /api/health/ready (readiness)
#------------------------------------------------------------------------------
livenessProbe:
  httpGet:
    path: /api/health/health
    port: 5000
  initialDelaySeconds: 45
  periodSeconds: 15
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /api/health/ready
    port: 5000
  initialDelaySeconds: 10
  periodSeconds: 5
  failureThreshold: 3

startupProbe:
  httpGet:
    path: /api/health/health
    port: 5000
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30

#------------------------------------------------------------------------------
# ConfigMap Data
#------------------------------------------------------------------------------
config:
  NODE_ENV: "staging"
  PORT: "5000"
  FRONTEND_URL: "http://shopdeploy-frontend:80"
  LOG_LEVEL: "info"

#------------------------------------------------------------------------------
# Secrets Data
#------------------------------------------------------------------------------
secrets:
  MONGODB_URI: "mongodb://mongodb:27017/shopdeploy"
  JWT_ACCESS_SECRET: "staging-jwt-access-secret-key-change-in-prod"
  JWT_REFRESH_SECRET: "staging-jwt-refresh-secret-key-change-in-prod"
